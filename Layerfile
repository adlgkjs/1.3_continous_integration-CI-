# Use an Ubuntu 18.04 base for our staging server
FROM vm/ubuntu:18.04

# To note: Layerfiles create entire VMs, *not* containers!

# Install PHP 8.1 & composer
RUN apt-get update && \
    apt-get install -y software-properties-common curl git unzip && \
    add-apt-repository ppa:ondrej/php -y && \
    apt-get update && \
    apt-get install -y php8.1 php8.1-cli php8.1-mbstring php8.1-zip php8.1-dom php8.1-curl

# Install Composer
RUN curl -sS https://getcomposer.org/installer -o composer-setup.php && \
    php composer-setup.php --install-dir=/usr/local/bin --filename=composer && \
    rm composer-setup.php

# Install Laravel
ENV COMPOSER_ALLOW_SUPERUSER=1 PATH=~/.config/composer/vendor/bin:$PATH
RUN composer global require laravel/installer

# Create sample blog (This step can be omitted if your repo already has a Laravel project)
RUN laravel new blog

WORKDIR blog
RUN composer install

# Start Laravel server
RUN php artisan serve --host 0.0.0.0 --port 80 &

# Expose website creates a unique link to view the website running in the server
EXPOSE 80
